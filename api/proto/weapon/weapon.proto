syntax = "proto3";

package weapon;

option go_package = "network-sec-micro/api/proto/weapon";

import "google/protobuf/timestamp.proto";

// Weapon Service (gRPC methods for service-to-service communication)
service WeaponService {
  // Get weapon details (for other services)
  rpc GetWeapon(GetWeaponRequest) returns (GetWeaponResponse);
  
  // Calculate warrior's total power based on owned weapons
  rpc CalculateWarriorPower(CalculateWarriorPowerRequest) returns (CalculateWarriorPowerResponse);

  // List weapons by owner (supports warrior, enemy, dragon)
  rpc ListOwnerWeapons(ListOwnerWeaponsRequest) returns (ListOwnerWeaponsResponse);

  // Apply wear/damage to a weapon; may mark as broken when durability reaches 0
  rpc ApplyWear(ApplyWearRequest) returns (ApplyWearResponse);
}

// Request to get weapon
message GetWeaponRequest {
  string weapon_id = 1;
}

// Response with weapon details
message GetWeaponResponse {
  Weapon weapon = 1;
}

// Request to calculate power
message CalculateWarriorPowerRequest {
  string warrior_username = 1;
}

// Response with calculated power
message CalculateWarriorPowerResponse {
  string warrior_username = 1;
  int32 base_power = 2;
  int32 weapon_bonus = 3;
  int32 total_power = 4;
  int32 weapon_count = 5;
}

// Weapon model
message Weapon {
  string id = 1;
  string name = 2;
  string description = 3;
  string type = 4; // "common", "rare", "legendary"
  int32 damage = 5;
  int32 price = 6;
  string created_by = 7;
  repeated string owned_by = 8; // legacy warrior usernames
  google.protobuf.Timestamp created_at = 9;
  google.protobuf.Timestamp updated_at = 10;

  // Durability fields
  int32 durability = 11;        // current durability (0..max_durability)
  int32 max_durability = 12;    // maximum durability
  bool is_broken = 13;          // derived from durability == 0

  // Generalized ownership (supports warrior/enemy/dragon) - optional for now
  repeated OwnerRef owners = 14; // when set, preferred over owned_by
}

// Owner reference to support multiple entity types
message OwnerRef {
  string owner_type = 1; // "warrior" | "enemy" | "dragon"
  string owner_id = 2;   // id or username depending on type
}

// Request to list weapons by owner
message ListOwnerWeaponsRequest {
  string owner_type = 1; // "warrior" | "enemy" | "dragon"
  string owner_id = 2;   // warrior username or entity id
}

// Response listing owner's weapons
message ListOwnerWeaponsResponse {
  repeated Weapon weapons = 1;
}

// Request to apply wear to a weapon
message ApplyWearRequest {
  string weapon_id = 1;
  int32 wear = 2; // how much durability to reduce
}

// Response after applying wear
message ApplyWearResponse {
  string weapon_id = 1;
  int32 durability = 2;
  bool is_broken = 3;
}

